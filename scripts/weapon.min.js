var traits,traits_rarity=0,currentTraits=[],stats_rarity=0;Handlebars.partials=Handlebars.templates;var xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){4==xhr.readyState&&(traits=JSON.parse(xhr.responseText))};xhr.open("GET",(window.location+"").replace(/localhost|verminguide\.com/,"api.verminguide.com")+"/traits");xhr.send();document.getElementById("shield").addEventListener("click",function(){setTraitPickerOpen(!1)});
Array.prototype.slice.call(document.getElementsByName("stats_rarity")).forEach(function(a){a.addEventListener("change",function(){switch(a.id){case "stats_rarity_plentiful":stats_rarity=0;updateWeaponStats(stats_rarity);break;case "stats_rarity_common":stats_rarity=1;updateWeaponStats(stats_rarity);break;case "stats_rarity_rare":stats_rarity=2;updateWeaponStats(stats_rarity);break;case "stats_rarity_exotic":stats_rarity=3;updateWeaponStats(stats_rarity);break;case "stats_rarity_veteran":stats_rarity=
4,updateWeaponStats(stats_rarity)}})});
Array.prototype.slice.call(document.getElementsByName("traits_rarity")).forEach(function(a){a.addEventListener("change",function(){switch(a.id){case "traits_rarity_common":traits_rarity=0;clearTraits(1);break;case "traits_rarity_rare":traits_rarity=1;clearTraits(2);break;case "traits_rarity_exotic":traits_rarity=2;clearTraits(3);break;case "traits_rarity_veteran":traits_rarity=3,setTrait(0,traits[3][0][0],!0),setTrait(1,traits[3][0][1],!0),setTrait(2,traits[3][0][2],!0)}})});
Array.prototype.slice.call(document.getElementsByClassName("trait_button")).forEach(function(a,d){a.addEventListener("click",function(){showPossibleTraits(d,getPossibleTraits(d))})});function setTrait(a,d,e){currentTraits[a]=d;void 0!=e&&(document.getElementById("trait"+a).style.display=e?"block":"none");if(void 0==e||e)d||(d={name:"Please select a trait..."}),document.getElementById("trait"+a).innerHTML=Handlebars.templates.trait(d)}
function clearTraits(a){setTrait(0,null,0<a);setTrait(1,null,1<a);setTrait(2,null,2<a);currentTraits=[]}function setTraitPickerOpen(a){document.getElementById("shield").style.display=document.getElementById("trait_picker").style.display=a?"block":"none"}
function showPossibleTraits(a,d){document.getElementById("trait_picker").innerHTML=Handlebars.templates.traits({traits:d,picker:!0});Array.prototype.slice.call(document.getElementById("trait_picker").getElementsByClassName("trait")).forEach(function(d,c){d.addEventListener("click",function(){setTrait(a,{name:d.dataset.name,description:d.dataset.description})})});setTraitPickerOpen(!0)}
function getPossibleTraits(a){for(var d=[],e=[],c=0;c<currentTraits.length;c++)c!=a&&e.push(currentTraits[c]);traits[traits_rarity].forEach(function(a){var b=0;for(c=0;c<e.length;c++)e[c]&&b++;var f=[];for(c=0;c<a.length;c++)e.some(function(b){return b&&b.name==a[c].name&&b.description==a[c].description})?b--:f.push(a[c]);if(0==b)for(c=0;c<f.length;c++)d.some(function(a){return a.name==f[c].name&&a.description==f[c].description})||d.push(f[c])});d.sort(function(a,b){return a.name>b.name?1:b.name>
a.name?-1:0});return d}
function updateWeaponStats(a){var d=document.getElementsByClassName("stat_label"),e=document.getElementsByClassName("hbar"),c=document.getElementsByClassName("vbar");if(weapons[a].attacks){for(var g=0,b=0;b<weapons.length;b++)for(var f=0;f<weapons[b].attacks.length;f++)for(var h in weapons[b].attacks[f].damage)weapons[b].attacks[f].damage.hasOwnProperty(h)&&weapons[b].attacks[f].damage[h]>g&&(g=weapons[b].attacks[f].damage[h]);for(b=0;b<weapons[a].attacks.length;b++)d[b].innerHTML=d[b].innerHTML.split(": ")[0]+
": "+weapons[a].attacks[b].damage.normal,e[b].style.width=weapons[a].attacks[b].damage.normal/g*100+"%",c[b].style.left="calc("+weapons[a].attacks[b].damage.normal/g*100+"% - 2.5px)"}else Array.prototype.slice.call(d).forEach(function(a){a.innerHTML=a.innerHTML.split(": ")[0]+": 0"}),Array.prototype.slice.call(e).forEach(function(a){a.style.width="0%"}),Array.prototype.slice.call(c).forEach(function(a){a.style.left="-2.5px"})}updateWeaponStats(0);clearTraits(1);
